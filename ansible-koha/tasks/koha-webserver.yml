---
- name: Configure Apache as required by Koha
  copy: src=../files/koha-httpd.conf dest=/etc/httpd/conf.d/koha.conf

- name: Create a user for Koha
  user: name=koha comment="Koha server" group=apache

- name: Make perl find the Koha modules
  file: src=/usr/share/koha/lib/{{ item }} dest=/usr/share/perl5/vendor_perl/{{ item }} state=link force=yes
  with_items:
    - C4
    - Koha
    - OpenILS
    - Koha.pm
  notify: restart apache

- name: Make Koha find the 64 bit Zebra module
  file: src=/usr/lib64/idzebra-2.0 dest=/usr/lib/idzebra-2.0 state=link force=yes

- name: Configure services to run Zebra
  copy: src=../files/{{ item }}.service dest=/etc/systemd/system/{{ item }}.service
  with_items:
    - zebraidx
    - zebrasrv
  notify: restart zebraidx

#- name: Add cronjobs for Koha
#  copy: src=../files/koha-cron dest=/etc/cron.d/koha

# Defaults for firewall, SELinux, Zebra and PazPar2 seem to work.
# TODO: Define ServerName in Apache configuration